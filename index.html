<meta charset="utf8" />
<html>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
    <!--     <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/sql-wasm.js" integrity="sha512-8oJoeo0ykAzuJzQFJDnwz9t4Rr+1xue7LFX+kr0NJMpOHH9QJPC563If+sakheUe3QbLwTTgXIGPC6YZTwp7Iw==" crossorigin="anonymous"></script> -->
    <script>

     require.config({
         paths: {
             "sql-wasm": "https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/sql-wasm"
         },
         waitSeconds: 40
     });

     require(['sql-wasm'],
             function success(initSqlJs) {
                 console.log(typeof initSqlJs);
                 if (typeof initSqlJs !== 'function') {
                     document.body.style.backgroundColor = 'red';
                     console.log('initSqlJs returned: ', initSqlJs);
                     alert("Failed to require sql.js through AMD");
                     return;
                 }
                 // The `initSqlJs` function is globally provided by all of the main dist files if loaded in the browser.
                 // We must specify this locateFile function if we are loading a wasm file from anywhere other than the current html page's folder.

                 var config = {
                     locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/${filename}`
                 }
                 initSqlJs(config).then(function (SQL) {
                     const dataPromise = fetch("output.db").then(res => res.arrayBuffer());
                     dataPromise.then((SQL, buf) => {
                         const db = new SQL.Database(new Uint8Array(buf));
                         var stmt = db.prepare("SELECT * FROM data WHERE start=10 AND target=11");
                         stmt.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}

                         var out = "";
                         // Bind new values
                         stmt.bind({$start:1, $end:2});
                         while(stmt.step()) { //
                             var row = stmt.getAsObject();
                             out += JSON.stringify(row);
                         }
                         document.getElementById("demo").innerHTML = out;
                     }).catch(err => {});
                 });
             },
             function error(err) {
                 document.body.style.backgroundColor = 'red';
                 console.log(err);
                 alert("Module load failed: " + err);
             }
     );
    </script>
    <body>
        <p id="test"></p>
    </body>
</html>
