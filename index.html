<meta charset="utf8" />
<html>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/sql-wasm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite-api"></script>

    <script type="module">
     /* import * as vega from 'https://cdn.skypack.dev/vega';
      * import * as vegaLite from 'https://cdn.skypack.dev/vega-lite';
      * import * as vegaEmbed from 'https://cdn.skypack.dev/vega-embed';
      * import * as vl from 'https://cdn.skypack.dev/vega-lite-api';
      * import * as vegaTooltip from 'https://cdn.skypack.dev/vega-tooltip'; */

     console.log(vega);
     console.log(vl);
     console.log(vegaEmbed);
     var config = {
         locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/${filename}`
     }
     initSqlJs(config).then(function (SQL) {
         const dataPromise = fetch("https://rationalis.github.io/maplestory-starforce-calc/output.db").then(res => res.arrayBuffer());
         dataPromise.then((buf) => {
             const db = new SQL.Database(new Uint8Array(buf));
             var stmt = db.prepare("SELECT * FROM data WHERE start=10 AND target=22");
             stmt.getAsObject({$start:1, $end:1}); // {col1:1, col2:111}

             var data = [];
             // Bind new values
             stmt.bind({$start:1, $end:2});
             while(stmt.step()) { //
                 var row = stmt.getAsObject();
                 data.push(row);
                 // out += JSON.stringify(row);
             }
             console.log(data);
             /*              document.getElementById("test").innerHTML = JSON.stringify(data); */
             var spec = vl.markBar()
                          .autosize('fit')
                          .width('container')
                          .height('container')
                          .data(data)
                          .encode(
                              vl.x().fieldQ("cost"),
                              vl.y().fieldQ("prob"),
                          )
                          .toObject();
             spec.mark.tooltip = {content: 'data'};
             console.log(spec);
             vegaEmbed('#view', spec, {renderer: "canvas"});
         }).catch(err => {console.log(err);});
     });
    </script>
    <body>
        <p id="test"></p>
        <div id="view" style="width:50%;height:50%;"></div>
    </body>
</html>
